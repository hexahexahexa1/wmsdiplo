# Откат прихода RCP-NEW-SKU-001 выполнен ✅

## Что было сделано

Приход **RCP-NEW-SKU-001** откачен в начальное состояние:

### Удалено:
- ✅ 3 задания (tasks)
- ✅ 3 скана (scans)
- ✅ 0 расхождений (discrepancies) 
- ✅ 3 паллеты (pallets)

### Сохранено:
- ✅ Приход (receipt) с id=28
- ✅ 3 строки прихода (receipt_lines)
- ✅ 3 SKU (автоматически созданные при импорте):
  1. NEW-SKU-2026 (100 шт)
  2. ANOTHER-NEW-SKU (50.5 кг)
  3. TEST-PRODUCT-XYZ (25 шт)

### Текущий статус:
```
doc_no: RCP-NEW-SKU-001
status: DRAFT
supplier: TestSupplier
lines: 3
```

## Как продолжить тестирование

Теперь вы можете заново пройти весь процесс приёмки с расхождениями:

### 1. В Desktop Client перейдите в "Приходы"
- Найдите приход RCP-NEW-SKU-001
- Статус должен быть DRAFT

### 2. Подтвердите приход
- Выберите приход
- Нажмите "Подтвердить"
- Статус: DRAFT → CONFIRMED

### 3. Начните приёмку
- Нажмите "Начать приёмку"
- Статус: CONFIRMED → IN_PROGRESS
- Система создаст задания типа RECEIVING

### 4. Перейдите в "Терминал"
- Вкладка "Терминал приёмки"
- Должны появиться задания для прихода RCP-NEW-SKU-001

### 5. Выполните задание С РАСХОЖДЕНИЕМ
- Дважды кликните на задание
- Нажмите "Назначить" → "Начать"
- Во вкладке "Факт" введите **МЕНЬШЕ** ожидаемого:
  - Паллета: PLT-TEST-001
  - Баркод: (можно оставить пустым)
  - Количество: **50** (вместо ожидаемых 100)
- Нажмите "Отправить"
- В таблице сканов должно появиться: **⚠ Есть расхождение**

### 6. Попробуйте завершить задание
- Нажмите "Завершить"
- Должен появиться **диалог подтверждения расхождения** с двумя кнопками:
  - "Подтвердить завершение"
  - "Отменить и вернуться к приёмке"

### 7. Тест А: Отмените и допримите
- Нажмите "Отменить и вернуться к приёмке"
- Введите оставшиеся 50 единиц
- Попробуйте завершить снова
- Диалог всё равно появится (т.к. первый скан с расхождением)

### 8. Тест Б: Подтвердите расхождение
- Нажмите "Подтвердить завершение"
- Задание завершится
- После завершения всех заданий приход перейдет в **PENDING_RESOLUTION**

## Файлы

- `rollback-rcp-new-sku-001.sql` - SQL скрипт отката (уже выполнен)
- `DISCREPANCY_CONFIRMATION_TEST.md` - подробная инструкция по тестированию

## Примечание

SKU, созданные при импорте, НЕ удалены - они останутся в справочнике. Это правильное поведение, т.к. номенклатура должна сохраняться даже если приход откачен.

Если нужно удалить и SKU тоже:
```sql
DELETE FROM skus WHERE code IN ('NEW-SKU-2026', 'ANOTHER-NEW-SKU', 'TEST-PRODUCT-XYZ');
```

Но это **НЕ рекомендуется**, т.к. может быть другой приход с этими SKU.
