# Запуск окружения для тестирования терминала приёмки

## Быстрый старт

### 1. Запустить окружение

Дважды кликнуть на файл:
```
start-environment.bat
```

Откроются 3 окна:
- **PostgreSQL** - база данных
- **Core API** - REST API сервер (~40 сек для запуска)
- **Desktop Client** - JavaFX приложение (~20 сек для запуска)

### 2. Войти в систему

В окне Desktop Client:
```
Username: testuser
Password: password
```

### 3. Открыть терминал

- Нажать кнопку **"Терминал"** в левой панели навигации
- Увидите список заданий пользователя testuser

### 4. Начать работу с заданием

- **Дважды кликнуть** на любое задание
- Откроется диалог с двумя табами:
  - **"Документ"** - ожидаемые данные
  - **"Факт"** - форма сканирования

### 5. Отсканировать товар

В табе "Факт":
1. Ввести код паллеты: `PLT-TEST-001` (Enter)
2. Ввести баркод: `SKU-TEST-002` (Enter)
3. Ввести количество: `10` (Enter - автоотправка)
4. Увидеть зелёную анимацию успеха ✅
5. Запись появится в истории сканов

---

## Тестовые данные

### Учетные данные
```
Username: testuser
Password: password
```

### Доступные паллеты
- `PLT-TEST-001` (пустая)
- `PLT-TEST-002` (пустая)
- `PLT-TEST-004` (пустая)
- `PLT-TEST-005` (пустая)

### Используемая паллета
- `PLT-TEST-003` (уже содержит SKU-TEST-002, qty=75)

### Баркоды товаров
- `SKU-TEST-001`
- `SKU-TEST-002`
- `SKU-TEST-003`

### Задания для testuser

| ID | Статус | Приход | Назначено | Выполнено |
|----|--------|--------|-----------|-----------|
| 3 | IN_PROGRESS | ACT-TEST-2026-001 | 50 | 0 |
| 4 | IN_PROGRESS | ACT-TEST-2026-002 | 200 | 75 |

---

## Сценарии тестирования

### Сценарий 1: Первый скан новой паллеты
1. Открыть задание ID=3
2. Паллета: `PLT-TEST-001`
3. Баркод: `SKU-TEST-002`
4. Количество: `10`
5. **Ожидание**: Скан записан, паллета инициализирована

### Сценарий 2: Продолжение работы с паллетой
1. В том же задании
2. Паллета: `PLT-TEST-001` (та же)
3. Баркод: `SKU-TEST-002`
4. Количество: `15`
5. **Ожидание**: Количество накоплено (25 всего)

### Сценарий 3: Частично выполненное задание
1. Открыть задание ID=4 (уже 75/200)
2. Проверить историю сканов (3 записи)
3. Паллета: `PLT-TEST-003`
4. Баркод: `SKU-TEST-002`
5. Количество: `20`
6. **Ожидание**: Прогресс стал 95/200

### Сценарий 4: Ошибка - неверный баркод
1. Открыть любое задание
2. Паллета: `PLT-TEST-002`
3. Баркод: `WRONG-BARCODE`
4. Количество: `10`
5. **Ожидание**: Скан записан с расхождением BARCODE_MISMATCH

### Сценарий 5: Ошибка - пустая паллета
1. Оставить поле "Паллета" пустым
2. Нажать "Отправить"
3. **Ожидание**: Красная тряска, сообщение "Код паллеты обязателен"

---

## Остановка окружения

Дважды кликнуть на файл:
```
stop-environment.bat
```

---

## Ручной запуск (если batch не работает)

### Terminal 1: PostgreSQL
```bash
docker compose up postgres
```

### Terminal 2: Core API
```bash
gradle :core-api:bootRun
```
Ждать сообщение: "Started CoreApiApplication in X seconds"

### Terminal 3: Desktop Client
```bash
gradle :desktop-client:run
```

---

## Проверка статуса

### PostgreSQL
```bash
docker ps
```
Должен быть контейнер `wmsdipl-postgres` в статусе "Up"

### Core API
Открыть в браузере: http://localhost:8080/actuator/health
Должен вернуть: `{"status":"UP"}`

### Desktop Client
Должно открыться окно JavaFX приложения

---

## Полный чеклист тестирования

См. файл: `docs/TERMINAL_TESTING_CHECKLIST.md`

---

## Подключение к БД (для проверки данных)

```bash
docker exec -it wmsdipl-postgres psql -U wmsdipl -d wmsdipl
```

Полезные запросы:
```sql
-- Посмотреть задания
SELECT * FROM tasks WHERE assignee = 'testuser';

-- Посмотреть сканы
SELECT * FROM scans ORDER BY scanned_at DESC LIMIT 10;

-- Посмотреть паллеты
SELECT code, status, quantity FROM pallets WHERE code LIKE 'PLT-TEST-%';
```

---

## Порты

- PostgreSQL: `55432`
- Core API: `8080`
- Desktop Client: N/A (JavaFX GUI)

---

## Troubleshooting

### Core API не запускается
- Проверить что PostgreSQL запущен: `docker ps`
- Проверить логи в окне "Core API"
- Порт 8080 должен быть свободен

### Desktop Client не запускается
- Проверить что Core API запущен: `curl http://localhost:8080/actuator/health`
- Проверить логи в окне "Desktop Client"

### Не могу войти в систему
- Username: `testuser` (без пробелов)
- Password: `password` (без пробелов)
- Проверить что Core API отвечает

### Не вижу заданий в терминале
- Проверить что вы вошли как `testuser`
- Нажать кнопку "Обновить"
- Проверить в БД: `SELECT * FROM tasks WHERE assignee = 'testuser';`

---

## Контакты

Вопросы и баги: создать issue в репозитории
