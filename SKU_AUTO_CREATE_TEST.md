# Тестирование автоматического создания SKU при импорте

## Что было сделано

### 1. Backend (core-api)
- ✅ Исправлен `ReceiptService.toLineFromImport()` для использования `skuService.findOrCreate()`
- ✅ Теперь при импорте прихода с новым SKU он автоматически создается в справочнике
- ✅ Удалена зависимость от `SkuRepository` в `ReceiptService` (используется только `SkuService`)

### 2. Desktop Client
- ✅ Создана модель `Sku` в `desktop-client/src/main/java/com/wmsdipl/desktop/model/Sku.java`
- ✅ Добавлены методы в `ApiClient`:
  - `listSkus()` - получить список всех SKU
  - `createSku(code, name, uom)` - создать новый SKU
  - `deleteSku(id)` - удалить SKU
- ✅ Добавлен справочник SKU во вкладку "Настройки" с функциями:
  - Просмотр всех SKU в таблице
  - Создание нового SKU через диалог
  - Удаление SKU
  - Обновление списка

## Как протестировать

### Шаг 1: Запустить окружение
```bash
start-environment.bat
```

### Шаг 2: Запустить core-api
```bash
start-core-api.bat
```

### Шаг 3: Запустить import-service
```bash
start-import-service.bat
```

### Шаг 4: Запустить desktop-client
```bash
start-desktop-client.bat
```

### Шаг 5: Войти в desktop-client
- Логин: `admin`
- Пароль: `password`

### Шаг 6: Проверить справочник SKU (ДО импорта)
1. Перейти во вкладку "Настройки"
2. Прокрутить вниз до раздела "Справочник номенклатур (SKU)"
3. Нажать "Обновить" чтобы загрузить текущий список SKU
4. Запомнить количество SKU в справочнике

### Шаг 7: Импортировать приход с новыми SKU
```bash
# Скопировать тестовый файл в папку импорта
copy test-new-sku-receipt.xml import-service\input\
```

Или через PowerShell:
```powershell
Copy-Item test-new-sku-receipt.xml -Destination import-service\input\
```

### Шаг 8: Проверить что приход создан
1. В desktop-client перейти во вкладку "Приходы"
2. Нажать "Обновить"
3. Должен появиться приход с `docNo = "RCP-NEW-SKU-001"`
4. Дважды кликнуть на приходе чтобы открыть диалог со строками
5. Проверить что все 3 строки имеют заполненный `skuId` (не null)

### Шаг 9: Проверить справочник SKU (ПОСЛЕ импорта)
1. Вернуться во вкладку "Настройки"
2. Нажать "Обновить" в разделе "Справочник номенклатур (SKU)"
3. В справочнике должны появиться 3 новых SKU:
   - `NEW-SKU-2026` с названием "Новый товар 2026" (ШТ)
   - `ANOTHER-NEW-SKU` с названием "Еще один новый товар" (КГ)
   - `TEST-PRODUCT-XYZ` с названием "Тестовый продукт XYZ" (ШТ)

### Шаг 10: Протестировать создание SKU вручную
1. Во вкладке "Настройки" в разделе SKU нажать "Создать SKU"
2. Заполнить форму:
   - Код SKU: `MANUAL-SKU-001`
   - Название: `Ручной тестовый SKU`
   - Единица измерения: `ШТ`
3. Нажать "Создать"
4. Диалог должен закрыться, таблица обновится и новый SKU появится в списке

### Шаг 11: Протестировать удаление SKU
1. Выбрать любой SKU в таблице (кроме тех, что используются в приходах)
2. Нажать "Удалить"
3. SKU должен исчезнуть из списка

## Ожидаемый результат

✅ Приход импортируется успешно без ошибок
✅ Все строки прихода имеют заполненный skuId
✅ В справочнике SKU появляются 3 новых записи с данными из XML
✅ Можно создавать новые SKU вручную через UI
✅ Можно удалять SKU через UI
✅ Больше нет приходов с пустыми SKU, требующих ручного заполнения

## Файлы для тестирования

- `test-new-sku-receipt.xml` - тестовый XML с 3 новыми SKU
- Содержит SKU которых нет в системе, они должны создаться автоматически

## Логи для проверки

### import-service
Должно быть сообщение:
```
Processed file test-new-sku-receipt.xml messageId=test-new-sku-20260108
```

### core-api
Должно быть сообщение о создании 3 новых SKU через `SkuService.findOrCreate()`
