# –ò–°–ü–†–ê–í–õ–ï–ù–ê: –û—à–∏–±–∫–∞ "–ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π –ø–∞–ª–ª–µ—Ç—ã"

## –ù–∞–π–¥–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã **–î–í–ï** –ø—Ä–æ–±–ª–µ–º—ã:

### 1. LazyInitializationException (–ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ)
- **–ü—Ä–∏—á–∏–Ω–∞**: –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω `JOIN FETCH` –≤ `PalletMovementRepository.findByPalletOrderByMovedAtDesc()`

### 2. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤ –¥–≤–∏–∂–µ–Ω–∏–π –≤ –ë–î (–ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ)
- **–ü—Ä–∏—á–∏–Ω–∞**: –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –±—ã–ª–æ –∑–Ω–∞—á–µ–Ω–∏–µ `PLACEMENT`, –∞ enum –æ–∂–∏–¥–∞–µ—Ç `PLACE`
- **–°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ**: 
  ```sql
  SELECT movement_type FROM pallet_movements;
  -- –ë—ã–ª–æ: PLACEMENT (–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)
  ```
- **–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–ª–µ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è –≤ –ë–î –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –û–±–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ
```sql
-- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
UPDATE pallet_movements SET movement_type = 'PLACE' WHERE movement_type = 'PLACEMENT';
-- –û–±–Ω–æ–≤–ª–µ–Ω–æ: 3 –∑–∞–ø–∏—Å–∏
```

### 2. –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
**–§–∞–π–ª**: `core-api/src/main/resources/db/migration/V021__fix_movement_types.sql`

–ú–∏–≥—Ä–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç legacy-–∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ:
- `PLACEMENT` ‚Üí `PLACE`
- `RECEIVING` ‚Üí `RECEIVE`
- `MOVING` ‚Üí `MOVE`
- `PICKING` ‚Üí `PICK`

### 3. –£–ª—É—á—à–µ–Ω StockMapper
**–§–∞–π–ª**: `core-api/src/main/java/com/wmsdipl/core/mapper/StockMapper.java`

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ `null` –≤ –º–µ—Ç–æ–¥–µ `toStockMovementDto()` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è NPE.

### 4. –£–ª—É—á—à–µ–Ω StockController
**–§–∞–π–ª**: `core-api/src/main/java/com/wmsdipl/core/web/StockController.java`

- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è `null` —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API (–ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ - –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)

### 5. –£–ª—É—á—à–µ–Ω Desktop Client
**–§–∞–π–ª**: `desktop-client/src/main/java/com/wmsdipl/desktop/DesktopClientApplication.java`

**–î—Ä—É–∂–µ–ª—é–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**:
- **–ü—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
- **–ü—Ä–∏ –ø—É—Å—Ç–æ–π –∏—Å—Ç–æ—Ä–∏–∏**: –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, –∫–æ–≥–¥–∞ –ø–æ—è–≤—è—Ç—Å—è –∑–∞–ø–∏—Å–∏:
  ```
  –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π –ø–æ–∫–∞ –ø—É—Å—Ç–∞.
  
  –ó–∞–ø–∏—Å–∏ –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ:
  ‚Ä¢ –ü—Ä–∏—ë–º–∫–∏ –ø–∞–ª–ª–µ—Ç—ã (RECEIVE)
  ‚Ä¢ –†–∞–∑–º–µ—â–µ–Ω–∏—è –Ω–∞ —Å–∫–ª–∞–¥–µ (PLACE)
  ‚Ä¢ –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –º–µ–∂–¥—É —è—á–µ–π–∫–∞–º–∏ (MOVE)
  ‚Ä¢ –û—Ç–±–æ—Ä–∞ —Ç–æ–≤–∞—Ä–∞ (PICK)
  ```

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

### –®–∞–≥ 1: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ core-api —Å–µ—Ä–≤–µ—Ä

**–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å**:
```bash
# –ù–∞–π—Ç–∏ PID
netstat -ano | findstr :8080

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
taskkill /PID <–Ω–æ–º–µ—Ä> /F
```

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä**:
```bash
cd E:\WMSDIPL
gradle :core-api:bootRun
```

–î–æ–∂–¥–∏—Ç–µ—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è: `Started CoreApiApplication in X.XXX seconds`

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ desktop-client

**–ï—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ Gradle**:
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å (Ctrl+C)
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
gradle :desktop-client:run
```

**–ï—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ JAR**:
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–∑–∞–∫—Ä–æ–π—Ç–µ –æ–∫–Ω–æ)
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
java -jar desktop-client/build/libs/desktop-client-*.jar
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É**: testuser / password
2. **–û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞–∑–¥–µ–ª "–û—Å—Ç–∞—Ç–∫–∏"**
3. **–ù–∞–π–¥–∏—Ç–µ –ø–∞–ª–ª–µ—Ç—É**: PLT-001, PLT-002 –∏–ª–∏ PLT-003
4. **–î–≤–∞–∂–¥—ã –∫–ª–∏–∫–Ω–∏—Ç–µ** –Ω–∞ —Å—Ç—Ä–æ–∫—É —Å –ø–∞–ª–ª–µ—Ç–æ–π
5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
   - ‚úÖ –î–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è –∏—Å—Ç–æ—Ä–∏—è –±–µ–∑ –æ—à–∏–±–æ–∫
   - ‚úÖ –î–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è –∑–∞–ø–∏—Å—å —Å —Ç–∏–ø–æ–º `PLACE`
   - ‚úÖ –ï—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏–∏ –Ω–µ—Ç - –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑–µ

–î–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
docker exec -i wmsdipl-postgres psql -U wmsdipl -d wmsdipl
```

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø—ã –¥–≤–∏–∂–µ–Ω–∏–π
SELECT movement_type, COUNT(*) 
FROM pallet_movements 
GROUP BY movement_type;

-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
-- RECEIVE, PLACE, MOVE, PICK, ADJUST

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–∞–ª–ª–µ—Ç—ã
SELECT 
    pm.id,
    p.code AS pallet,
    pm.movement_type,
    l_from.code AS from_loc,
    l_to.code AS to_loc,
    pm.moved_by,
    pm.moved_at
FROM pallet_movements pm
JOIN pallets p ON p.id = pm.pallet_id
LEFT JOIN locations l_from ON l_from.id = pm.from_location_id
LEFT JOIN locations l_to ON l_to.id = pm.to_location_id
WHERE p.code = 'PLT-001'
ORDER BY pm.moved_at DESC;
```

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î

```sql
-- –ü–∞–ª–ª–µ—Ç—ã —Å –∏—Å—Ç–æ—Ä–∏–µ–π
id | pallet | movement_type | from_loc | to_loc | moved_by | moved_at
----+--------+---------------+----------+--------+----------+---------
4  | PLT-001| PLACE         | LOC-001  | LOC-001| testuser | 2026-01-08
5  | PLT-002| PLACE         | LOC-001  | LOC-001| testuser | 2026-01-08
6  | PLT-003| PLACE         | LOC-001  | LOC-001| testuser | 2026-01-08
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ:
```bash
gradle :core-api:test --tests "*StockControllerTest"
# BUILD SUCCESSFUL
# 10 tests passed
```

## –ß—Ç–æ –¥–∞–ª—å—à–µ?

–î–ª—è –Ω–æ–≤—ã—Ö –ø–∞–ª–ª–µ—Ç –∏—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏:

1. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—Ä–∏–µ–º–∫–∏** ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å `RECEIVE`
2. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è** ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å `PLACE`
3. **–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ –ø–∞–ª–ª–µ—Ç—ã** ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å `MOVE` (–≤ –±—É–¥—É—â–µ–º)
4. **–û—Ç–±–æ—Ä–µ —Ç–æ–≤–∞—Ä–∞** ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å `PICK` (–≤ –±—É–¥—É—â–µ–º)

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

‚úÖ `core-api/src/main/java/com/wmsdipl/core/repository/PalletMovementRepository.java`  
‚úÖ `core-api/src/main/java/com/wmsdipl/core/mapper/StockMapper.java`  
‚úÖ `core-api/src/main/java/com/wmsdipl/core/web/StockController.java`  
‚úÖ `core-api/src/main/resources/db/migration/V021__fix_movement_types.sql` (—Å–æ–∑–¥–∞–Ω)  
‚úÖ `desktop-client/src/main/java/com/wmsdipl/desktop/DesktopClientApplication.java`  
‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (3 –∑–∞–ø–∏—Å–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã)

## –°—Ç–∞—Ç—É—Å

üü¢ **–í–°–ï –ò–°–ü–†–ê–í–õ–ï–ù–û –ò –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ**

- –ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω ‚úÖ
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ ‚úÖ
- –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ ‚úÖ
- –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç ‚úÖ
- –£–ª—É—á—à–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö ‚úÖ
- –î–æ–±–∞–≤–ª–µ–Ω–æ –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø—É—Å—Ç–æ–π –∏—Å—Ç–æ—Ä–∏–∏ ‚úÖ
