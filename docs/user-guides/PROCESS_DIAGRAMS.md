# 📊 Визуальная схема процесса приёмки

## Полная схема движения прихода

```
                    🚚 ПОСТАВЩИК ОТГРУЗИЛ ТОВАР
                              ↓
        ┌─────────────────────────────────────────────┐
        │  📥 IMPORT SERVICE                          │
        │  - Получен XML файл с накладной             │
        │  - Создан приход в БД                       │
        └─────────────────────────────────────────────┘
                              ↓
╔═══════════════════════════════════════════════════════════╗
║  СТАТУС: DRAFT (Черновик)                                 ║
║  👤 Ответственный: Import Service (автоматически)         ║
╚═══════════════════════════════════════════════════════════╝
                              ↓
        ┌─────────────────────────────────────────────┐
        │  👨‍💼 SUPERVISOR действие #1                   │
        │  ✅ Подтверждает приход                      │
        │     Меню: Приходы → Подтвердить             │
        └─────────────────────────────────────────────┘
                              ↓
╔═══════════════════════════════════════════════════════════╗
║  СТАТУС: CONFIRMED (Подтверждён)                          ║
║  👤 Ответственный: Supervisor                             ║
║  📄 Приход готов к приёмке                                ║
╚═══════════════════════════════════════════════════════════╝
                              ↓
        ┌─────────────────────────────────────────────┐
        │  👨‍💼 SUPERVISOR действие #2                   │
        │  🚀 Начинает приёмку                         │
        │     Меню: Приходы → Начать приёмку          │
        │  🎯 Система создаёт задания RECEIVING        │
        │     (по 1 заданию на каждую строку прихода)  │
        └─────────────────────────────────────────────┘
                              ↓
╔═══════════════════════════════════════════════════════════╗
║  СТАТУС: RECEIVING (Идёт приёмка)                         ║
║  👤 Ответственный: Operators                              ║
║  📦 Созданы задания типа RECEIVING                        ║
╚═══════════════════════════════════════════════════════════╝
                              ↓
        ┌─────────────────────────────────────────────┐
        │  👷 OPERATOR(ы) - работа с заданиями         │
        │                                              │
        │  Для каждого задания RECEIVING:              │
        │  ┌────────────────────────────────────────┐  │
        │  │ 1️⃣ Назначить себе                      │  │
        │  │ 2️⃣ Начать задание                      │  │
        │  │ 3️⃣ Сканировать:                        │  │
        │  │    - Паллета: PLT-XXX                  │  │
        │  │    - Баркод товара                     │  │
        │  │    - Количество                        │  │
        │  │    - Брак (если есть)                  │  │
        │  │    - Партия, срок годности             │  │
        │  │ 4️⃣ Отправить скан                      │  │
        │  │ 5️⃣ Завершить задание                   │  │
        │  └────────────────────────────────────────┘  │
        │                                              │
        │  🔄 Повторить для всех заданий              │
        └─────────────────────────────────────────────┘
                              ↓
        ┌─────────────────────────────────────────────┐
        │  🖥️ PC_OPERATOR - мониторинг                │
        │  📊 Контролирует:                           │
        │     - Сколько заданий выполнено             │
        │     - Есть ли задания без исполнителя       │
        │     - Есть ли "зависшие" задания            │
        │  ⚠️ Сообщает супервизору о проблемах        │
        └─────────────────────────────────────────────┘
                              ↓
        ┌─────────────────────────────────────────────┐
        │  👨‍💼 SUPERVISOR действие #3                   │
        │  ✅ Завершает приёмку                        │
        │     Меню: Приходы → Завершить приёмку       │
        │  ⚠️ Проверяет расхождения                   │
        └─────────────────────────────────────────────┘
                              ↓
╔═══════════════════════════════════════════════════════════╗
║  СТАТУС: RECEIVED (Принято)                               ║
║  👤 Ответственный: Supervisor                             ║
║  📦 Товар принят, готов к размещению                      ║
╚═══════════════════════════════════════════════════════════╝
                              ↓
        ┌─────────────────────────────────────────────┐
        │  👨‍💼 SUPERVISOR действие #4                   │
        │  🚀 Начинает размещение                      │
        │     Меню: Приходы → Начать размещение       │
        │  🎯 Система создаёт задания PLACEMENT        │
        │     + определяет целевые ячейки              │
        └─────────────────────────────────────────────┘
                              ↓
╔═══════════════════════════════════════════════════════════╗
║  СТАТУС: PLACING (Идёт размещение)                        ║
║  👤 Ответственный: Operators                              ║
║  📦 Созданы задания типа PLACEMENT                        ║
╚═══════════════════════════════════════════════════════════╝
                              ↓
        ┌─────────────────────────────────────────────┐
        │  👷 OPERATOR(ы) - размещение на склад        │
        │                                              │
        │  Для каждого задания PLACEMENT:              │
        │  ┌────────────────────────────────────────┐  │
        │  │ 1️⃣ Назначить себе / Начать            │  │
        │  │ 2️⃣ Посмотреть целевую ячейку:         │  │
        │  │    Вкладка "Документ" → 🎯 A-01-05     │  │
        │  │ 3️⃣ Вкладка "Факт" - сканировать:      │  │
        │  │    - Паллета: PLT-XXX                  │  │
        │  │    - Баркод товара                     │  │
        │  │    - Количество                        │  │
        │  │    - 📍 Ячейка: A-01-05 (ВАЖНО!)      │  │
        │  │ 4️⃣ Отправить → Завершить              │  │
        │  └────────────────────────────────────────┘  │
        │                                              │
        │  🔄 Повторить для всех заданий              │
        └─────────────────────────────────────────────┘
                              ↓
        ┌─────────────────────────────────────────────┐
        │  👨‍💼 SUPERVISOR действие #5 (ФИНАЛ)           │
        │  ✅ Принимает приход                         │
        │     Меню: Приходы → Принять                 │
        │  ✅ Проверяет размещение в остатках          │
        └─────────────────────────────────────────────┘
                              ↓
╔═══════════════════════════════════════════════════════════╗
║  СТАТУС: STOCKED (Размещён)                               ║
║  👤 Ответственный: -                                      ║
║  ✅ ПРИХОД ПОЛНОСТЬЮ ОБРАБОТАН                            ║
║  📦 Товар на складе, остатки актуальны                    ║
╚═══════════════════════════════════════════════════════════╝
                              ↓
                      🎉 ГОТОВО! 🎉
```

---

## Параллельные процессы по ролям

### Линия времени

```
Время  │ SUPERVISOR          │ OPERATOR             │ PC_OPERATOR
───────┼────────────────────┼─────────────────────┼──────────────────
00:00  │ Подтверждает       │                      │ Видит DRAFT
       │ DRAFT → CONFIRMED  │                      │ Мониторит
───────┼────────────────────┼─────────────────────┼──────────────────
00:05  │ Начинает приёмку   │                      │ Видит создание
       │ CONFIRMED →        │                      │ заданий
       │ RECEIVING          │                      │
───────┼────────────────────┼─────────────────────┼──────────────────
00:10  │ Мониторит          │ Назначает задание   │ Проверяет
       │ прогресс           │ себе                 │ назначения
───────┼────────────────────┼─────────────────────┼──────────────────
00:15  │                    │ Начинает работу     │ Видит IN_PROGRESS
       │                    │ Сканирует товар     │
───────┼────────────────────┼─────────────────────┼──────────────────
00:30  │                    │ Завершает 1-е       │ Считает
       │                    │ задание             │ выполненные
───────┼────────────────────┼─────────────────────┼──────────────────
00:45  │                    │ Работает над 2-м    │ Мониторит
       │                    │ заданием            │ задержки
───────┼────────────────────┼─────────────────────┼──────────────────
01:00  │ Проверяет все      │ Завершил все        │ Подтверждает
       │ задания COMPLETED  │ задания             │ 100% выполнение
───────┼────────────────────┼─────────────────────┼──────────────────
01:05  │ Завершает приёмку  │                     │ Видит RECEIVED
       │ RECEIVING →        │                     │
       │ RECEIVED           │                     │
───────┼────────────────────┼─────────────────────┼──────────────────
01:10  │ Начинает           │                     │ Видит создание
       │ размещение         │                     │ PLACEMENT
       │ RECEIVED → PLACING │                     │ заданий
───────┼────────────────────┼─────────────────────┼──────────────────
01:15  │                    │ Назначает PLACEMENT │ Мониторит
       │                    │ задание             │
───────┼────────────────────┼─────────────────────┼──────────────────
01:30  │                    │ Размещает паллеты   │ Проверяет
       │                    │ в ячейки            │ ячейки
───────┼────────────────────┼─────────────────────┼──────────────────
02:00  │ Проверяет          │ Все размещено       │ Проверяет
       │ размещение         │                     │ остатки
───────┼────────────────────┼─────────────────────┼──────────────────
02:05  │ ПРИНИМАЕТ приход   │                     │ Видит STOCKED
       │ PLACING → STOCKED  │                     │ ✅
───────┼────────────────────┼─────────────────────┼──────────────────
       │      ✅ ГОТОВО       │       ✅ ГОТОВО      │      ✅ ГОТОВО
```

---

## Схема доступа по ролям

```
┌────────────────────────────────────────────────────────────┐
│                         ДЕЙСТВИЯ                           │
├────────────────────┬───────────┬──────────┬────────────────┤
│ Действие           │ SUPERVISOR│ OPERATOR │ PC_OPERATOR    │
├────────────────────┼───────────┼──────────┼────────────────┤
│ Просмотр приходов  │     ✅    │    ✅    │      ✅        │
│ Подтвердить приход │     ✅    │    ❌    │      ❌        │
│ Начать приёмку     │     ✅    │    ❌    │      ❌        │
│ Завершить приёмку  │     ✅    │    ❌    │      ❌        │
│ Начать размещение  │     ✅    │    ❌    │      ❌        │
│ Принять приход     │     ✅    │    ❌    │      ❌        │
├────────────────────┼───────────┼──────────┼────────────────┤
│ Просмотр заданий   │     ✅    │    ✅    │      ✅        │
│ Назначить задание  │     ✅    │    ✅*   │      ❌        │
│ Начать задание     │     ❌    │    ✅    │      ❌        │
│ Выполнить задание  │     ❌    │    ✅    │      ❌        │
│ Завершить задание  │     ❌    │    ✅    │      ❌        │
├────────────────────┼───────────┼──────────┼────────────────┤
│ Просмотр остатков  │     ✅    │    ✅    │      ✅        │
│ Просмотр паллет    │     ✅    │    ✅    │      ✅        │
│ Создать паллету    │     ✅    │    ❌    │      ❌        │
├────────────────────┼───────────┼──────────┼────────────────┤
│ Просмотр аналитики │     ✅    │    ❌    │      ✅        │
│ Просмотр топологии │     ✅    │    ❌    │      ❌        │
│ Управление зонами  │     ✅    │    ❌    │      ❌        │
│ Управление ячейками│     ✅    │    ❌    │      ❌        │
├────────────────────┼───────────┼──────────┼────────────────┤
│ Управление SKU     │     ✅    │    ❌    │      ❌        │
│ Управление юзерами │     ❌**  │    ❌    │      ❌        │
└────────────────────┴───────────┴──────────┴────────────────┘

* Operator может назначить задание только СЕБЕ
** Только ADMIN может управлять пользователями
```

---

## Схема потока данных

```
┌─────────────────────────────────────────────────────────────┐
│                     БАЗА ДАННЫХ (PostgreSQL)                 │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │ receipts │  │  tasks   │  │ pallets  │  │   skus   │   │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘   │
│       │             │             │             │           │
└───────┼─────────────┼─────────────┼─────────────┼───────────┘
        │             │             │             │
        └─────────────┴─────────────┴─────────────┘
                      ↓
        ┌─────────────────────────────────┐
        │   CORE API (Spring Boot)        │
        │   Port: 8080                    │
        │                                  │
        │   Endpoints:                    │
        │   - GET  /api/receipts          │
        │   - POST /api/receipts/confirm  │
        │   - POST /api/tasks/assign      │
        │   - POST /api/scans             │
        │   - ...                         │
        └─────────────────────────────────┘
                      ↑
        ┌─────────────┴─────────────┐
        │                            │
┌───────▼────────┐          ┌────────▼────────┐
│ DESKTOP CLIENT │          │ IMPORT SERVICE  │
│  (JavaFX)      │          │  (Spring Boot)  │
│  Port: -       │          │  Port: 8090     │
│                │          │                 │
│  Users:        │          │  Watches:       │
│  - Supervisor  │          │  - Folder       │
│  - Operator    │          │  - XML files    │
│  - PC_Operator │          │                 │
└────────────────┘          └─────────────────┘
```

---

## Схема жизненного цикла задания

```
                    ┌──────────────┐
                    │ Создано      │
                    │  (NEW)       │
                    └──────┬───────┘
                           │
                    ┌──────▼───────┐
          Supervisor│   или    ↓Operator
          назначает │  назначает себе
                    └──────┬───────┘
                           │
                    ┌──────▼───────┐
                    │  Назначено   │
                    │  (ASSIGNED)  │
                    └──────┬───────┘
                           │
                    Operator нажал
                      "Начать"
                           │
                    ┌──────▼───────┐
                    │  В работе    │
                    │(IN_PROGRESS) │
                    └──────┬───────┘
                           │
                   ┌───────┴────────┐
                   │                │
          Operator │         Supervisor
          нажал    │         отменил
          "Завершить"       задание
                   │                │
            ┌──────▼───────┐  ┌─────▼──────┐
            │  Завершено   │  │  Отменено  │
            │  (COMPLETED) │  │ (CANCELLED)│
            └──────────────┘  └────────────┘
                   │
              Задание больше
              не редактируется
                   │
                   ✅
```

---

## Схема принятия решений для Supervisor

```
                 Новый приход загружен
                         │
                         ▼
              ┌──────────────────────┐
              │  Статус = DRAFT?     │
              └──────┬──────────┬────┘
                     │ Да       │ Нет
                     ▼          ▼
            Подтвердить    Ждать загрузки
                     │
                     ▼
              ┌──────────────────────┐
              │ Статус = CONFIRMED?  │
              └──────┬──────────┬────┘
                     │ Да       │ Нет
                     ▼          ▼
            Начать приёмку   Проверить
                     │         ошибки
                     ▼
              ┌──────────────────────┐
              │ Все задания         │
              │ RECEIVING выполнены?│
              └──────┬──────────┬────┘
                     │ Да       │ Нет
                     ▼          ▼
          Завершить приёмку   Ждать/Помочь
                     │         операторам
                     ▼
              ┌──────────────────────┐
              │  Статус = RECEIVED?  │
              └──────┬───────────────┘
                     │ Да
                     ▼
            Начать размещение
                     │
                     ▼
              ┌──────────────────────┐
              │ Все задания         │
              │ PLACEMENT выполнены?│
              └──────┬──────────┬────┘
                     │ Да       │ Нет
                     ▼          ▼
             Принять приход   Ждать/Помочь
                     │         операторам
                     ▼
                  STOCKED
                     ✅
```

---

## Схема сканирования для Operator

```
┌─────────────────────────────────────────────────────┐
│  Вкладка "ФАКТ" - Форма сканирования                │
├─────────────────────────────────────────────────────┤
│                                                      │
│  ┌──────────────────────────────────────────────┐   │
│  │ 📷 Паллета:    [____________]   ← ОБЯЗАТЕЛЬНО│  │
│  │                (PLT-001)                      │   │
│  └──────────────────────────────────────────────┘   │
│         ↓ Отсканировали паллету                     │
│                                                      │
│  ┌──────────────────────────────────────────────┐   │
│  │ 📷 Баркод:     [____________]                │   │
│  │                (1234567890)                   │   │
│  └──────────────────────────────────────────────┘   │
│         ↓ Отсканировали товар                       │
│                                                      │
│  ┌──────────────────────────────────────────────┐   │
│  │ ✏️ Количество: [____]          ← ОБЯЗАТЕЛЬНО │   │
│  │                (100)                          │   │
│  └──────────────────────────────────────────────┘   │
│         ↓ Ввели количество                          │
│                                                      │
│  ┌──────────────────────────────────────────────┐   │
│  │ 🚨 Повреждения:                              │   │
│  │    ☑️ Товар повреждён                        │   │
│  │    Тип: [Упаковка▼]                         │   │
│  │    Описание: [_______________]               │   │
│  └──────────────────────────────────────────────┘   │
│         ↓ Заполнили (если есть брак)                │
│                                                      │
│  ┌──────────────────────────────────────────────┐   │
│  │ 📦 Партия и срок:                            │   │
│  │    Партия: [_______________]  (опционально)  │   │
│  │    Срок:   [дд.мм.гггг]       (опционально)  │   │
│  └──────────────────────────────────────────────┘   │
│                                                      │
│  ┌──────────────────────────────────────────────┐   │
│  │ 📍 Ячейка:     [____________] ← Только для   │   │
│  │                (A-01-05)        PLACEMENT!    │   │
│  └──────────────────────────────────────────────┘   │
│                                                      │
│  ┌──────────────────────────────────────────────┐   │
│  │ ✏️ Комментарий: [_______________]            │   │
│  └──────────────────────────────────────────────┘   │
│                                                      │
│          [  ОТПРАВИТЬ  ]  ← Нажать!                 │
│                                                      │
│  ─────────────────────────────────────────────────  │
│                                                      │
│  📊 История сканов:                                 │
│  ┌────────────────────────────────────────────┐     │
│  │ Паллета │Баркод│Кол-во│Расхождение│Время │     │
│  │ PLT-001 │ 123  │ 100  │   ✓ ОК    │15:30 │     │
│  │ PLT-002 │ 456  │ 50   │ ⚠ -10     │15:35 │     │
│  └────────────────────────────────────────────┘     │
│                                                      │
└─────────────────────────────────────────────────────┘
```

---

**📘 См. также:**
- [Полное руководство](RECEIPT_PROCESSING_GUIDE.md)
- [Быстрая шпаргалка](QUICK_REFERENCE.md)
