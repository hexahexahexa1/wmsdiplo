# üéØ –§–∏–Ω–∞–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ UNDER_QTY - –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –î–∏–∞–ª–æ–≥ –ù–ï –ø–æ—è–≤–ª—è–ª—Å—è –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—á–µ
**–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞ `hasDiscrepancies()` –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å **–î–û** –≤—ã–∑–æ–≤–∞ `completeTask()`, –Ω–æ UNDER_QTY —Å–æ–∑–¥–∞–µ—Ç—Å—è **–í–ù–£–¢–†–ò** –º–µ—Ç–æ–¥–∞ complete –Ω–∞ backend.

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ **–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** –Ω–µ–¥–æ—Å—Ç–∞—á–∏ –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º:
```java
boolean hasUnderQty = currentTask.qtyDone().compareTo(currentTask.qtyAssigned()) < 0;
```

–¢–µ–ø–µ—Ä—å –¥–∏–∞–ª–æ–≥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –µ—Å–ª–∏:
- ‚úÖ –ï—Å—Ç—å UNDER_QTY (–ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)
- ‚úÖ –ï—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –≤ —Å–∫–∞–Ω–∞—Ö (OVER_QTY, BARCODE_MISMATCH, SSCC_MISMATCH)

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –¢–∞–±–ª–∏—Ü–∞ —Å–∫–∞–Ω–æ–≤ –ù–ï –æ–±–Ω–æ–≤–ª—è–ª–∞—Å—å –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
**–ü—Ä–∏—á–∏–Ω–∞**: –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –≤–∫–ª–∞–¥–∫–∞ "–§–∞–∫—Ç" –Ω–µ –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–ª–∞—Å—å, –ø–æ–∫–∞–∑—ã–≤–∞—è —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ.

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∞ –≤–∫–ª–∞–¥–∫–∏ "–§–∞–∫—Ç" –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
```java
factTab.setContent(buildFactTab(currentTask[0], dialog));
```

–¢–µ–ø–µ—Ä—å –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "‚ö† –ï—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ".

## üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Backend: `TaskLifecycleService.java`
- –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ UNDER_QTY –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏
- –°–æ–∑–¥–∞–µ—Ç—Å—è Discrepancy –∑–∞–ø–∏—Å—å
- –ü–æ–º–µ—á–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–∫–∞–Ω —Ñ–ª–∞–≥–æ–º `discrepancy = true`

### Frontend: `DesktopClientApplication.java`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ UNDER_QTY –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∞ –≤–∫–ª–∞–¥–∫–∏ "–§–∞–∫—Ç" –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- –î–∏–∞–ª–æ–≥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –®–∞–≥ 1: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

**Core-API —É–∂–µ –∑–∞–ø—É—â–µ–Ω —Å –Ω–æ–≤—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏** ‚úÖ

**Desktop-Client –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å**:
```bash
# –ó–∞–∫—Ä–æ–π—Ç–µ —Ç–µ–∫—É—â–∏–π desktop-client
# –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ:
gradle :desktop-client:run
```

### –®–∞–≥ 2: –¢–µ—Å—Ç –Ω–µ–¥–æ—Å—Ç–∞—á–∏ (UNDER_QTY)

1. **–í–æ–π–¥–∏—Ç–µ**: admin / password
2. **–ù–∞–π–¥–∏—Ç–µ –ø—Ä–∏—Ö–æ–¥**: RCP-NEW-SKU-001 (—Å—Ç–∞—Ç—É—Å: DRAFT)
3. **–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ** ‚Üí "–ù–∞—á–∞—Ç—å –ø—Ä–∏–µ–º–∫—É"
4. **–¢–µ—Ä–º–∏–Ω–∞–ª** ‚Üí –æ—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±—É—é –∑–∞–¥–∞—á—É
5. **–ù–∞–∑–Ω–∞—á–∏—Ç—å** ‚Üí **–ù–∞—á–∞—Ç—å**
6. **–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ —Å –Ω–µ–¥–æ—Å—Ç–∞—á–µ–π**:
   - –ü–∞–ª–ª–µ—Ç–∞: `PLT-001`
   - –ë–∞—Ä–∫–æ–¥: (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)
   - **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: 50** (–º–µ–Ω—å—à–µ —á–µ–º –æ–∂–∏–¥–∞–µ—Ç—Å—è!)
   - –ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø–∏—Å–∞—Ç—å —Å–∫–∞–Ω"
7. **–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ó–∞–≤–µ—Ä—à–∏—Ç—å"**

### ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–°–†–ê–ó–£ –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è "–ó–∞–≤–µ—Ä—à–∏—Ç—å"**:
1. ‚úÖ –ü–æ—è–≤–∏—Ç—Å—è –¥–∏–∞–ª–æ–≥:
   ```
   ‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–∏—ë–º–∫–µ!
   
   –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ —Å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è–º–∏?
   –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π.
   
   [–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ] [–û—Ç–º–µ–Ω–∏—Ç—å –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–∏—ë–º–∫–µ]
   ```

**–ü—Ä–∏ –≤—ã–±–æ—Ä–µ "–û—Ç–º–µ–Ω–∏—Ç—å"**:
2. ‚úÖ –î–∏–∞–ª–æ–≥ –∑–∞–∫—Ä–æ–µ—Ç—Å—è
3. ‚úÖ –ú–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
4. ‚úÖ –ó–∞–¥–∞—á–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è IN_PROGRESS

**–ü—Ä–∏ –≤—ã–±–æ—Ä–µ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"**:
5. ‚úÖ –ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è (COMPLETED)
6. ‚úÖ **–¢–∞–±–ª–∏—Ü–∞ —Å–∫–∞–Ω–æ–≤ –æ–±–Ω–æ–≤–∏—Ç—Å—è** ‚Üí –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–∫–∞–Ω –ø–æ–∫–∞–∂–µ—Ç **"‚ö† –ï—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ"**
7. ‚úÖ –°—Ç–∞—Ç—É—Å: "–ó–∞–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```sql
docker exec -i wmsdipl-postgres psql -U wmsdipl -d wmsdipl

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ UNDER_QTY
SELECT id, type, qty_expected, qty_actual, comment 
FROM discrepancies 
WHERE receipt_id = 28;

-- –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
-- type = 'UNDER_QTY'
-- qty_expected = (—Ç–æ —á—Ç–æ –æ–∂–∏–¥–∞–ª–æ—Å—å)
-- qty_actual = 50
-- comment = 'Task completed with less quantity than assigned'

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–∫–∞–Ω
SELECT id, pallet_code, qty, discrepancy 
FROM scans 
WHERE task_id IN (SELECT id FROM tasks WHERE receipt_id = 28)
ORDER BY scanned_at DESC 
LIMIT 1;

-- discrepancy –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å TRUE
```

## üîÑ –°–±—Ä–æ—Å –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –µ—â–µ —Ä–∞–∑:

```bash
docker exec -i wmsdipl-postgres psql -U wmsdipl -d wmsdipl <<'EOF'
DELETE FROM scans WHERE task_id IN (SELECT id FROM tasks WHERE receipt_id = 28);
DELETE FROM tasks WHERE receipt_id = 28;
DELETE FROM discrepancies WHERE receipt_id = 28;
DELETE FROM pallets WHERE receipt_id = 28;
UPDATE receipts SET status = 'DRAFT' WHERE id = 28;
EOF
```

## üìä –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚ùå
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ó–∞–≤–µ—Ä—à–∏—Ç—å"
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ hasDiscrepancies() ‚Üí false (–µ—â–µ –Ω–µ—Ç UNDER_QTY)
3. –î–∏–∞–ª–æ–≥ –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
4. completeTask() ‚Üí —Å–æ–∑–¥–∞–µ—Ç UNDER_QTY –Ω–∞ backend
5. –¢–∞–±–ª–∏—Ü–∞ –ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
6. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è "‚úì –û–ö" –≤–º–µ—Å—Ç–æ "‚ö† –ï—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ"
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚úÖ
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ó–∞–≤–µ—Ä—à–∏—Ç—å"
2. –ö–ª–∏–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: qtyDone < qtyAssigned? ‚Üí true
3. –î–∏–∞–ª–æ–≥ –ü–û–ö–ê–ó–´–í–ê–ï–¢–°–Ø
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç
5. completeTask() ‚Üí —Å–æ–∑–¥–∞–µ—Ç UNDER_QTY –Ω–∞ backend + –ø–æ–º–µ—á–∞–µ—Ç —Å–∫–∞–Ω
6. –í–∫–ª–∞–¥–∫–∞ "–§–∞–∫—Ç" –ü–ï–†–ï–°–¢–†–ê–ò–í–ê–ï–¢–°–Ø
7. –¢–∞–±–ª–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
8. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è "‚ö† –ï—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ"
```

## üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

### –¢–µ—Å—Ç 1: –ü—Ä–∏–µ–º–∫–∞ —Ç–æ—á–Ω–æ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç—É (–±–µ–∑ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π)
- –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ **—Ç–æ—á–Ω–æ–µ** –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
- –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≤–µ—Ä—à–∏—Ç—å"
- **–û–∂–∏–¥–∞–µ—Ç—Å—è**: –¥–∏–∞–ª–æ–≥ –ù–ï –ø–æ—è–≤–ª—è–µ—Ç—Å—è, –∑–∞–¥–∞—á–∞ —Å—Ä–∞–∑—É –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è

### –¢–µ—Å—Ç 2: –ü—Ä–∏–µ–º–∫–∞ —Å –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ–º (OVER_QTY)
- –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ **–±–æ–ª—å—à–µ** —á–µ–º –æ–∂–∏–¥–∞–µ—Ç—Å—è
- –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≤–µ—Ä—à–∏—Ç—å"
- **–û–∂–∏–¥–∞–µ—Ç—Å—è**: –¥–∏–∞–ª–æ–≥ –ø–æ—è–≤–ª—è–µ—Ç—Å—è (–∏–∑-–∑–∞ OVER_QTY, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –≤–æ –≤—Ä–µ–º—è —Å–∫–∞–Ω–∞)

### –¢–µ—Å—Ç 3: –û—Ç–º–µ–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å –Ω–µ–¥–æ—Å—Ç–∞—á–µ–π
- –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ –º–µ–Ω—å—à–µ
- –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≤–µ—Ä—à–∏—Ç—å"
- –í—ã–±–µ—Ä–∏—Ç–µ "–û—Ç–º–µ–Ω–∏—Ç—å"
- **–û–∂–∏–¥–∞–µ—Ç—Å—è**: –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –¥–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –æ—Å—Ç–∞—Ç–æ–∫

## üìÑ –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `UNDER_QTY_DISCREPANCY_FIX.md` - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- `DISCREPANCY_CONFIRMATION_TEST.md` - –æ–±—â–µ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π

## ‚ö° –°—Ç–∞—Ç—É—Å

- ‚úÖ Backend —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω
- ‚úÖ Frontend —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω
- ‚úÖ Core-API –∑–∞–ø—É—â–µ–Ω
- ‚è≥ Desktop-Client –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
- ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã

**–ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ!** üöÄ

–î–∞—Ç–∞: 08 —è–Ω–≤–∞—Ä—è 2026
